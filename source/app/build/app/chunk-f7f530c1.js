class e{constructor(e,t){window.indexedDB||window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available."),this._IndxDb=window.indexedDB,this._dbName=e,this._dbSchema=t}open(){let e=this;var t=!1;return new Promise((r,a)=>{var n=this._IndxDb.open(e._dbName,1);n.onupgradeneeded=function(){t=!0,e.addObjectStores(n.result,e._dbSchema)},n.onerror=function(e){a("LuaDatabase - open - error: "+e.target.errorCode)},n.onsuccess=function(){e._db=n.result,r({upgradeNeeded:t})}})}addObjectStores(e,t){for(let r=0;r<t.length;r++){let a=e.createObjectStore(t[r].name,{keyPath:"id",autoIncrement:!0});if(a.createIndex("id_idx","id",{unique:!0}),void 0!==t[r].indexes)for(let e=0;e<t[r].indexes.length;e++){let n=t[r].indexes[e];if(0===n.indexOf("*")){let e=n.substr(1,n.length-1);a.createIndex(`${e}_idx`,e,{multiEntry:!0})}else a.createIndex(`${n}_idx`,n)}if(void 0!==t[r].seeds)for(let e=0;e<t[r].seeds.length;e++)a.put(t[r].seeds[e])}}populateObjectStores(){let e=this;return new Promise((t,r)=>{e.populatePlantsSettingStore().then(()=>e.populatePlantNameStore()).then(()=>{t("LuaDatabase - populateObjectStores - succeed")}).catch(()=>{r("LuaDatabase - populateObjectStores - failed")})})}populatePlantsSettingStore(){let e=this;return new Promise((t,r)=>{fetch("./assets/json/LuaDatabase.json").then(e=>e.text()).then(e=>JSON.parse(e)).then(a=>{var n=e._db.transaction(["plantsSetting"],"readwrite");n.oncomplete=function(){t("LuaDatabase - populatePlantsSettingStore - succeed")},n.onerror=function(){console.log("LuaDatabase - populatePlantsSettingStore - failed"),r("LuaDatabase - populatePlantsSettingStore - failed")};var o=n.objectStore("plantsSetting");a.plants.forEach(function(e){o.put(e)})})})}populatePlantNameStore(){let e=this;return new Promise((t,r)=>{var a;a=navigator.language.indexOf("fr")>=0?"./assets/json/PlantsName_fr.json":"./assets/json/PlantsName_en.json",fetch(a).then(e=>e.text()).then(e=>JSON.parse(e)).then(a=>{var n=e._db.transaction(["plantsName"],"readwrite");n.oncomplete=function(){t("LuaDatabase - populatePlantNameStore - succeed")},n.onerror=function(){console.log("LuaDatabase - populatePlantNameStore - failed"),r("LuaDatabase - populatePlantNameStore - failed")};var o=n.objectStore("plantsName");a.plantsName.forEach(function(t){var r=/\'|\(|\)|\[|\]/gi,a=e.getAllWords(t.latinName.replace(r," ").toLowerCase());t.commonName.forEach(t=>{t.length>0&&e.getAllWords(t.replace(r," ").toLowerCase()).forEach(e=>{a.push(e)})}),t.searchWords=a,o.put(t)})})})}getAllLatinNames(){let e=this;var t=[];return new Promise((r,a)=>{var n=e._db.transaction(["plants"],"readonly");n.oncomplete=function(){r(t)},n.onerror=function(e){console.log("LuaDatabase - getAllLatinNames - transaction error: "+e.target.errorCode),a("LuaDatabase - getAllLatinNames - transaction error: "+e.target.errorCode)},n.objectStore("plants").openCursor().onsuccess=function(e){var r=e.target.result;r&&(t.push(r.value.latinName),r.continue())}})}countObjects(e){let t=this;var r=0;return new Promise((a,n)=>{var o=t._db.transaction([e],"readonly");o.oncomplete=function(){a(r)},o.onerror=function(e){console.log("LuaDatabase - countObjects - transaction error: "+e.target.errorCode),n("LuaDatabase - countObjects - transaction error: "+e.target.errorCode)},o.objectStore(e).count().onsuccess=function(e){r=e.target.result}})}storeObject(e,t){let r=this;return new Promise((a,n)=>{var o=r._db.transaction([e],"readwrite");o.oncomplete=function(){a()},o.onerror=function(e){console.log("LuaDatabase - storeObject - transaction error: "+e.target.errorCode),n("LuaDatabase - storeObject - transaction error: "+e.target.errorCode)};const s=o.objectStore(e).put(t);s.onerror=function(e){n("LuaDatabase - storeObject - request error: "+e.target.errorCode)},s.onsuccess=function(e){a(e.target.result)}})}setObject(e,t,r,a){let n=this;return new Promise((o,s)=>{if(""!==t&&""!==r){var c=n._db.transaction([e],"readwrite");c.oncomplete=function(){o(!1)},c.onerror=function(e){console.log("LuaDatabase - setObject - transaction error: "+e.target.errorCode),s("LuaDatabase - setObject - transaction error: "+e.target.errorCode)};var i=c.objectStore(e);(i.keyPath===t?i.openCursor(r):i.index(t+"_idx").openCursor(r)).onsuccess=function(e){const t=e.target.result;if(!t)return void o(!1);var r=a;r.id=t.value.id;const n=t.update(r);n.onerror=function(e){s("LuaDatabase - setObject - request error: "+e.target.errorCode)},n.onsuccess=function(){o(!0)}}}else o(!1)})}getAllObjects(e){let t=this;var r=[];return new Promise((a,n)=>{var o=t._db.transaction([e],"readonly");o.oncomplete=function(){a(r)},o.onerror=function(e){console.log("LuaDatabase - getAllObjects - transaction error: "+e.target.errorCode),n("LuaDatabase - getAllObjects - transaction error: "+e.target.errorCode)},o.objectStore(e).openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.push(t.value),t.continue())}})}getObject(e,t,r){let a=this;var n;return new Promise((o,s)=>{var c=a._db.transaction([e],"readonly");c.oncomplete=function(){o(n)},c.onerror=function(e){console.log("LuaDatabase - getObject - transaction error: "+e.target.errorCode),s("LuaDatabase - getObject - transaction error: "+e.target.errorCode)};var i,l=c.objectStore(e);(i=l.keyPath===t?l.openCursor(r):l.index(t+"_idx").openCursor(r)).onsuccess=function(e){var t=e.target.result;t&&(n=t.value)},i.onerror=function(e){s("LuaDatabase - getObject - request error: "+e.target.errorCode)}})}deleteObject(e,t,r){let a=this;return new Promise((n,o)=>{var s=a._db.transaction([e],"readwrite");s.oncomplete=function(){n(!0)},s.onerror=function(e){console.log("LuaDatabase - deleteObject - transaction error: "+e.target.errorCode),o("LuaDatabase - deleteObject - transaction error: "+e.target.errorCode)};var c=s.objectStore(e);(c.keyPath===t?c.openCursor(r):c.index(t+"_idx").openCursor(r)).onsuccess=function(e){var t=e.target.result;if(t){const e=t.delete();e.onerror=function(e){o("LuaDatabase - deleteObject - request error: "+e.target.errorCode)},e.onsuccess=function(){n(!0)}}else n()}})}getAllPlantsCompleteName(){let e=this;var t=[];return new Promise((r,a)=>{var n=e._db.transaction(["plantsName"],"readonly");n.oncomplete=function(){r(t)},n.onerror=function(e){console.log("LuaDatabase - getAllLatinNames - transaction error: "+e.target.errorCode),a("LuaDatabase - getAllLatinNames - transaction error: "+e.target.errorCode)},n.objectStore("plantsName").openCursor().onsuccess=function(e){var r=e.target.result;if(r){var a=r.value.commonName;t.push(0===a[0].length?[r.value.latinName,[]]:[r.value.latinName,a.toString()]),r.continue()}}})}getPlantSetting(e){let t=this;var r=[];return new Promise((a,n)=>{var o=t._db.transaction(["plantsSetting"],"readonly");o.oncomplete=function(){a(r)},o.onerror=function(e){console.log("LuaDatabase - getPlantSetting - transaction error: "+e.target.errorCode),n("LuaDatabase - getPlantSetting - transaction error: "+e.target.errorCode)};var s=o.objectStore("plantsSetting").index("latinName_idx").get(e);s.onerror=function(e){console.log("LuaDatabase - getPlantSetting - request error: "+e.target.errorCode),n("LuaDatabase - getPlantSetting - request error: "+e.target.errorCode)},s.onsuccess=function(){a(s.result)}})}searchForPlants(e){let t=this;return new Promise((r,a)=>{e.indexOf(" ")>-1?t.searchForPlantsCaseInsentive("latinName_idx",e).then(a=>{if(0===a.length)return t.searchForPlantsCaseInsentive("commonName_idx",e);r(a)}).then(e=>{r(0!==e.length?e:[])}).catch(()=>{a("LuaDatabase - searchForPlants - failed")}):t.searchForPlantsCaseInsentive("searchWords_idx",e).then(e=>{r(0!==e.length?e:[])}).catch(()=>{a("LuaDatabase - searchForPlants - failed")})})}searchForPlantsCaseInsentive(e,t){let r=this;var a=[];return new Promise((n,o)=>{var s=t.toUpperCase(),c=t.toLowerCase(),i=r._db.transaction(["plantsName"],"readonly");i.oncomplete=function(){n(a)},i.onerror=function(e){console.log("LuaDatabase - searchForPlantsCaseInsentive - transaction error: "+e.target.errorCode),o("LuaDatabase - searchForPlantsCaseInsentive - transaction error: "+e.target.errorCode)},i.objectStore("plantsName").index(e).openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n=t.key;if(0===n.length&&t.continue("A"),"string"==typeof n){var o=n.toLowerCase();if(0===o.indexOf(c)){var i=t.value.commonName;a.push(0===i[0].length?[t.value.latinName,[]]:[t.value.latinName,i.toString()]),t.continue()}else{var l=r.nextCasing(n,o,s,c);if(!l)return;t.continue(l)}}else t.continue()}}})}logLatinWordsIndex(){let e=this,t=0;return new Promise((r,a)=>{var n=e._db.transaction(["plantsName"],"readonly");n.oncomplete=function(e){console.log("LuaDatabase - logLatinWordsIndex - transaction complete: "+e.target),r()},n.onerror=function(e){console.log("LuaDatabase - logLatinWordsIndex - transaction error: "+e.target.errorCode),a("LuaDatabase - logLatinWordsIndex - transaction error: "+e.target.errorCode)},n.objectStore("plantsName").index("commonName_idx").openCursor().onsuccess=function(e){var r=e.target.result;if(r){var a=r.key;"string"==typeof a?++t>500||(console.log("LuaDatabase - logLatinWordsIndex - cursor key="+a+"; latinName="+r.value.latinName+"; commonName="+r.value.commonName),r.continue()):r.continue()}else console.log("LuaDatabase - logLatinWordsIndex - No more entries!")}})}nextCasing(e,t,r,a){for(var n=Math.min(e.length,a.length),o=0;o<n;++o){if(t[o]!==a[o])return e[o]<r[o]?e.substr(0,o)+r[o]+r.substr(o+1):e[o]<a[o]?e.substr(0,o)+a[o]+r.substr(o+1):null;if(n<a.length)return e+r.substr(e.length)}}getAllWords(e){var t=e.split(" ").reduce(function(e,t){return t.length>1&&(e[t]=!0),e},{});return Object.keys(t)}}var t=new e("UserDatabase",[{name:"plants",indexes:["name","latinName","*commonName"],seeds:[]}]);function r(e){var t;try{t=window[e];var r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}async function a(){return new Promise((e,r)=>{t.open().then(()=>{e()},()=>r())})}async function n(){return new Promise((e,r)=>{t.countObjects("plants").then(t=>{e(0===t)},()=>r())})}async function o(e){return new Promise((r,a)=>{t.storeObject("plants",e).then(e=>{r(e)},()=>a())})}async function s(e,r){return t.setObject("plants","id",e,r)}async function c(e){return t.deleteObject("plants","id",e)}async function i(e){return t.getObject("plants","id",e)}async function l(){return t.getAllObjects("plants")}export{r as a,a as b,i as c,s as d,e,o as f,n as g,c as h,l as i};